services:
  - name: nexus-backend
    type: web
    env: node
    region: frankfurt
    plan: free
    rootDir: .
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL        # popuni u Renderu (Neon pooled URI sa sslmode=require)
        sync: false
    buildCommand: |
      npm ci || npm i
      chmod +x node_modules/.bin/prisma || true
      npx prisma generate
      npx prisma migrate deploy
    startCommand: node src/index.js
    healthCheckPath: /healthz

  - name: nexus-frontend
    type: web
    env: node
    region: frankfurt
    plan: free
    rootDir: frontend
    autoDeploy: true
    envVars:
      - key: VITE_API_URL        # popuni u Renderu (URL backend servisa, bez završne /)
        sync: false
    buildCommand: npm ci && npm run build
    startCommand: npx serve -s dist -l $PORT
