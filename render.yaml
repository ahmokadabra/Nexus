services:
  - name: nexus-backend
    type: web
    runtime: node
    region: frankfurt
    plan: free
    rootDir: .
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL   # postavit ćeš vrijednost nakon kreiranja
        sync: false
    buildCommand: |
      npm ci || npm i
      chmod -R +x node_modules/.bin || true
      node ./node_modules/prisma/build/index.js generate
      node ./node_modules/prisma/build/index.js migrate deploy
    startCommand: node src/index.js
    healthCheckPath: /healthz

  - name: nexus-frontend
    type: static
    rootDir: frontend
    plan: free
    region: frankfurt
    autoDeploy: true
    buildCommand: npm ci && npm run build
    publishPath: dist
    envVars:
      - key: VITE_API_URL   # postavi nakon kreiranja (URL backend servisa)
        sync: false
    routes:
      - type: rewrite
        source: /*
        destination: /index.html


